#!/bin/bash

# Modern aesthetic sketchybar configuration with aerospace integration
# Colors and icons are defined in separate files for better organization

source "$CONFIG_DIR/colors.sh"
source "$CONFIG_DIR/icons.sh"

PLUGIN_DIR="$CONFIG_DIR/plugins"

##### Bar Appearance #####
sketchybar --bar position=top height=36 \
                 color=$BAR_COLOR \
                 border_width=0 \
                 corner_radius=0 \
                 margin=0 \
                 blur_radius=0 \
                 padding_left=16 \
                 padding_right=16 \
                 shadow=off \
                 sticky=on \
                 topmost=window \
                 display=main

##### Changing Defaults #####
default=(
  updates=when_shown
  icon.font="FiraCode Nerd Font Mono:Bold:15.0"
  icon.color=$ICON_COLOR
  icon.padding_left=6
  icon.padding_right=6
  label.font="FiraCode Nerd Font Mono:Regular:13.0"
  label.color=$LABEL_COLOR
  label.padding_left=6
  label.padding_right=6
  padding_left=8
  padding_right=8
  background.height=26
  background.corner_radius=6
  background.border_width=2
  background.border_color=$BACKGROUND_2
  popup.background.border_width=2
  popup.background.corner_radius=6
  popup.background.border_color=$POPUP_BORDER_COLOR
  popup.background.color=$POPUP_BACKGROUND_COLOR
)

sketchybar --default "${default[@]}"

##### Aerospace integration #####
# AeroSpace will trigger workspace changes via exec-on-workspace-change
# No need for polling listener - AeroSpace handles this directly

##### Left Side Items #####

# Apple Logo
sketchybar --add item apple.logo left \
           --set apple.logo icon=$APPLE \
                           icon.font="Fira Sans:Black:20.0" \
                           icon.color=$WHITE \
                           padding_right=16 \
                           padding_left=12 \
                           label.drawing=off \
                           click_script="$PLUGIN_DIR/apple.sh"

# Yabai Spaces
source "$CONFIG_DIR/items/spaces.sh"

# Front App
sketchybar --add item front_app left \
           --set front_app icon.drawing=off \
                          label.font="Fira Sans:Bold:13.0" \
                          label.color=$WHITE \
                          label.padding_left=2 \
                          label.padding_right=8 \
                          label.y_offset=-1.1 \
                          padding_left=2 \
                          padding_right=8 \
                          y_offset=0 \
                          script="$PLUGIN_DIR/front_app.sh" \
           --subscribe front_app front_app_switched

##### Right Side Items #####

# Clock
sketchybar --add item clock right \
           --set clock icon="󰅐" \
                       icon.font="Fira Sans:Semibold:15.0" \
                       icon.color=$WHITE \
                       icon.padding_left=8 \
                       icon.padding_right=6 \
                       icon.y_offset=0 \
                       label.font="Fira Sans:Medium:12.0" \
                       label.color=$WHITE \
                       label.padding_left=4 \
                       label.padding_right=8 \
                       label.y_offset=0 \
                       update_freq=10 \
                       script="$PLUGIN_DIR/clock.sh" \
                       background.color=$BACKGROUND_1 \
                       background.border_color=$BACKGROUND_2 \
                       background.corner_radius=8 \
                       background.height=24 \
                       background.drawing=on \
                       padding_left=4 \
                       padding_right=4 \
                       click_script="$PLUGIN_DIR/clock_click.sh"

# WiFi
sketchybar --add item wifi right \
           --set wifi icon="󰤨" \
                      icon.font="Fira Sans:Semibold:15.0" \
                      icon.color=$WHITE \
                      icon.padding_left=8 \
                      icon.padding_right=6 \
                      icon.y_offset=0 \
                      label.font="Fira Sans:Medium:12.0" \
                      label.color=$WHITE \
                      label.padding_left=4 \
                      label.padding_right=8 \
                      label.y_offset=0 \
                      update_freq=30 \
                      script="$PLUGIN_DIR/wifi.sh" \
                      background.color=$BACKGROUND_1 \
                      background.border_color=$BACKGROUND_2 \
                      background.corner_radius=8 \
                      background.height=24 \
                      background.drawing=on \
                      padding_left=4 \
                      padding_right=4

## Removed: CPU Usage (minimal setup)
# sketchybar --add item cpu right \
#            --set cpu icon.font="SF Pro:Semibold:15.0" \
#                      icon.color=$ACCENT_PRIMARY \
#                      icon.padding_left=8 \
#                      icon.padding_right=6 \
#                      label.font="Fira Sans:Medium:12.0" \
#                      label.color=$WHITE \
#                      label.width=50 \
#                      label.align=right \
#                      label.padding_left=4 \
#                      label.padding_right=8 \
#                      update_freq=5 \
#                      script="$PLUGIN_DIR/cpu.sh" \
#                      background.color=$BACKGROUND_1 \
#                      background.drawing=on \
#                      padding_left=4 \
#                      padding_right=4

## Removed: CPU Temperature (minimal setup)
# sketchybar --add item cpu_temp right \
#            --set cpu_temp icon.font="SF Pro:Semibold:15.0" \
#                           icon.color=$ACCENT_SECONDARY \
#                           icon.padding_left=8 \
#                           icon.padding_right=6 \
#                           label.font="Fira Sans:Medium:12.0" \
#                           label.color=$WHITE \
#                           label.width=50 \
#                           label.align=right \
#                           label.padding_left=4 \
#                           label.padding_right=8 \
#                           update_freq=5 \
#                           script="$PLUGIN_DIR/cpu_temp.sh" \
#                           background.color=$BACKGROUND_1 \
#                           background.drawing=on \
#                           padding_left=4 \
#                           padding_right=4

# VPN pill removed per user preference

# Battery
sketchybar --add item battery right \
           --set battery icon.font="SF Pro:Semibold:15.0" \
                        icon.color=$WHITE \
                        icon.padding_left=8 \
                        icon.padding_right=6 \
                        icon.y_offset=0 \
                        label.font="Fira Sans:Medium:12.0" \
                        label.color=$WHITE \
                        label.padding_left=4 \
                        label.padding_right=8 \
                        label.y_offset=0 \
                        update_freq=120 \
                        script="$PLUGIN_DIR/battery.sh" \
                        background.color=$BACKGROUND_1 \
                        background.border_color=$BACKGROUND_2 \
                        background.corner_radius=8 \
                        background.height=24 \
                        background.drawing=on \
                        padding_left=4 \
                        padding_right=4 \
           --subscribe battery system_woke power_source_change


# Weather
# sketchybar --add item weather right \
#            --set weather icon="Û∞ñï" \
#                         icon.font="Fira Sans:Semibold:15.0" \
#                         icon.color=$BLUE \
#                         icon.padding_left=8 \
#                         icon.padding_right=6 \
#                         label.padding_left=4 \
#                         label.padding_right=8 \
#                         update_freq=1800 \
#                         script="$PLUGIN_DIR/weather.sh" \
#                         background.color=$BACKGROUND_1 \
#                         background.drawing=on \
#                         padding_left=4 \
#                         padding_right=4

##### Finalize Setup #####
sketchybar --update
